<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malzeme YÃ¶netimi â€¢ B2B Admin</title>
    
    <!-- Font & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== VARIABLES ===== */
        :root {
            /* Colors */
            --color-primary: #2563eb;
            --color-primary-dark: #1d4ed8;
            --color-primary-light: #dbeafe;
            --color-secondary: #8b5cf6;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-info: #3b82f6;
            --color-light: #f8fafc;
            --color-dark: #1e293b;
            --color-gray: #64748b;
            --color-gray-light: #e2e8f0;
            --color-gray-lighter: #f1f5f9;
            
            /* Layout */
            --border-radius: 8px;
            --border-radius-sm: 6px;
            --shadow: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 20px rgba(0,0,0,0.12);
            --transition: all 0.3s ease;
        }

        /* ===== RESET ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--color-light);
            color: var(--color-dark);
            line-height: 1.6;
            padding: 20px;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== MAIN LAYOUT ===== */
        .malzeme-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }

        /* ===== TOP SECTION ===== */
        .top-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ===== SEARCH SECTION ===== */
        .search-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid var(--color-gray-light);
            box-shadow: var(--shadow);
        }

        .section-header {
            margin-bottom: 20px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--color-dark);
            margin-bottom: 8px;
        }

        .section-subtitle {
            font-size: 0.9rem;
            color: var(--color-gray);
        }

        /* SEARCH FORM */
        .search-form {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-input-container {
            position: relative;
            flex: 1;
            min-width: 150px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 35px;
            border: 1px solid var(--color-primary);
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            transition: var(--transition);
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--color-primary-dark);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-gray);
        }

        .search-btn {
            flex-shrink: 0;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
        }

        /* FILTERS */
        .filters-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-gray);
        }

        .filter-select {
            padding: 10px 12px;
            border: 1px solid var(--color-gray-light);
            border-radius: var(--border-radius-sm);
            background: white;
            font-size: 0.9rem;
            transition: var(--transition);
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        /* QUICK ACTIONS */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 10px 15px;
            border: 1px solid var(--color-gray-light);
            background: white;
            border-radius: var(--border-radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--color-gray);
        }

        .action-btn:hover {
            background: var(--color-gray-lighter);
            transform: translateY(-2px);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            border: none;
        }

        .action-btn.primary:hover {
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* ===== TABLE SECTION ===== */
        .table-section {
            flex: 1;
            background: white;
            border-radius: var(--border-radius);
            border: 1px solid var(--color-gray-light);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* TABLE HEADER */
        .table-header {
            background: linear-gradient(135deg, var(--color-dark), #334155);
            border-bottom: 3px solid var(--color-primary);
            padding: 15px 20px;
        }

        .table-header-row {
            display: grid;
            grid-template-columns: 40px 100px minmax(250px, 1fr) 120px 90px 120px 90px 100px 70px 100px;
            gap: 15px;
            align-items: center;
        }

        .table-header-cell {
            color: white;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        /* TABLE STYLES */
        .products-table-container {
            flex: 1;
            overflow: hidden;
        }

        .products-table-wrapper {
            height: 100%;
            overflow: auto;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        .products-table tbody tr {
            transition: var(--transition);
            border-bottom: 1px solid var(--color-gray-lighter);
        }

        .products-table tbody tr:hover {
            background: var(--color-gray-lighter);
        }

        .products-table tbody tr.selected {
            background: var(--color-primary-light);
        }

        .products-table td {
            padding: 14px 8px;
            vertical-align: middle;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.85rem;
        }

        /* PRODUCT CODE & NAME */
        .product-code {
            font-weight: 700;
            color: var(--color-primary);
            font-size: 0.85rem;
        }

        .product-name {
            font-weight: 600;
            color: var(--color-dark);
            line-height: 1.4;
            font-size: 0.9rem;
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* MANUFACTURER */
        .manufacturer-badge {
            background: var(--color-gray-lighter);
            color: var(--color-gray);
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            white-space: nowrap;
        }

        /* STOCK INFO - GENÄ°ÅžLETÄ°LMÄ°Åž */
        .stock-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stock-location {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
        }

        .stock-location .location-name {
            color: var(--color-gray);
            flex: 1;
        }

        .stock-location .location-value {
            font-weight: 600;
            color: var(--color-dark);
            margin-left: 10px;
            min-width: 40px;
            text-align: right;
        }

        .stock-high .location-value {
            color: var(--color-success);
        }

        .stock-medium .location-value {
            color: var(--color-warning);
        }

        .stock-low .location-value {
            color: var(--color-danger);
        }

        /* STOCK SUMMARY */
        .stock-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px dashed var(--color-gray-light);
        }

        .stock-total {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--color-primary-dark);
        }

        .stock-count {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-dark);
            background: var(--color-primary-light);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* PRICE INFO */
        .price-info {
            text-align: center;
        }

        .price-value {
            font-weight: 700;
            color: var(--color-dark);
            font-size: 0.9rem;
        }

        /* DISCOUNT INFO */
        .discount-info {
            text-align: center;
        }

        .discount-badges {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .discount-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            min-width: 35px;
            text-align: center;
        }

        .discount-5 {
            background: linear-gradient(135deg, var(--color-primary), #1d4ed8);
        }

        .discount-10 {
            background: linear-gradient(135deg, var(--color-success), #059669);
        }

        .discount-20 {
            background: linear-gradient(135deg, var(--color-warning), #d97706);
        }

        .discount-other {
            background: linear-gradient(135deg, var(--color-secondary), #7c3aed);
        }

        /* ACTIONS COLUMN */
        .product-actions {
            display: flex;
            gap: 6px;
            justify-content: center;
        }

        .action-btn-small {
            width: 34px;
            height: 34px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--color-gray-lighter);
            color: var(--color-gray);
            border: 1px solid var(--color-gray-light);
            font-size: 0.8rem;
        }

        .action-btn-small:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .action-btn-small.edit:hover {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .action-btn-small.settings:hover {
            background: var(--color-secondary);
            color: white;
            border-color: var(--color-secondary);
        }

        /* TOGGLE SWITCH */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-gray-light);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--color-success);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* LOADING & EMPTY STATES */
        .loading-row, .empty-row {
            text-align: center;
            padding: 40px 15px;
        }

        .loading-content, .empty-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            color: var(--color-gray);
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* PAGINATION */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-top: 1px solid var(--color-gray-light);
        }

        .pagination-info {
            font-size: 0.9rem;
            color: var(--color-dark);
            font-weight: 600;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .pagination-btn {
            padding: 8px 14px;
            border: 1px solid var(--color-gray-light);
            background: white;
            border-radius: var(--border-radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--color-gray-lighter);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-numbers {
            display: flex;
            gap: 6px;
        }

        .page-number {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--color-gray-light);
            border-radius: var(--border-radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .page-number:hover {
            background: var(--color-gray-lighter);
        }

        .page-number.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 80%;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 25px;
        }

        .modal-section {
            margin-bottom: 30px;
        }

        .modal-section-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary-dark);
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-primary-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-dark);
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-gray-light);
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 5px;
        }

        .range-value {
            min-width: 45px;
            font-weight: 700;
            color: var(--color-primary);
            font-size: 0.95rem;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 25px;
            border-top: 1px solid var(--color-gray-light);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--color-gray-lighter);
            color: var(--color-dark);
            border: 1px solid var(--color-gray-light);
        }

        .btn-secondary:hover {
            background: var(--color-gray-light);
        }

        /* STATISTICS BADGE */
        .statistics-badge {
            background: linear-gradient(135deg, var(--color-success), var(--color-success-dark));
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }

        /* RESPONSIVE */
        @media (max-width: 1400px) {
            .filters-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .table-header-row {
                grid-template-columns: 40px 90px minmax(200px, 1fr) 90px 80px 110px 80px 90px 60px 90px;
                gap: 10px;
            }
            
            .modal-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .malzeme-container {
                gap: 15px;
            }
            
            .search-section {
                padding: 15px;
            }
            
            .search-form {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input-container {
                flex: 0 0 100%;
                min-width: auto;
            }
            
            .search-btn {
                width: 100%;
                justify-content: center;
            }
            
            .filters-row {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-wrap: wrap;
            }
            
            .table-header-row {
                display: none;
            }
            
            .products-table {
                font-size: 0.75rem;
            }
            
            .modal-content {
                width: 95%;
                max-height: 90vh;
            }
        }
    </style>
</head>
<body>
    <!-- MAIN CONTAINER -->
    <div class="malzeme-container">
        <!-- SEARCH SECTION -->
        <div class="search-section">
            <div class="section-header">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <h2 class="section-title">
                            <i class="fas fa-boxes"></i> Malzeme YÃ¶netimi
                        </h2>
                        <p class="section-subtitle">
                            TÃ¼m malzemeleri gÃ¶rÃ¼ntÃ¼le, filtrele ve yÃ¶net
                        </p>
                    </div>
                    <div class="statistics-badge" id="statisticsBadge">
                        <i class="fas fa-chart-bar"></i>
                        <span id="totalProductsCount">0</span> Ã¼rÃ¼n
                    </div>
                </div>
            </div>

            <!-- SEARCH FORM -->
            <form class="search-form" id="searchForm" onsubmit="searchProducts(); return false;">
                <div class="search-input-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" 
                           placeholder="Malzeme kodu, OEM kodu, Ã¼retici kodu veya aÃ§Ä±klamada ara...">
                </div>
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i> Ara
                </button>
            </form>

            <!-- FILTERS -->
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Ãœretici</label>
                    <select class="filter-select" id="manufacturerFilter">
                        <option value="">TÃ¼m Ãœreticiler</option>
                        <option value="bosch">Bosch</option>
                        <option value="makita">Makita</option>
                        <option value="dewalt">DeWalt</option>
                        <option value="stanley">Stanley</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Stok Durumu</label>
                    <select class="filter-select" id="stockFilter">
                        <option value="">TÃ¼mÃ¼</option>
                        <option value="high">YÃ¼ksek Stok (50+)</option>
                        <option value="medium">Orta Stok (10-49)</option>
                        <option value="low">DÃ¼ÅŸÃ¼k Stok (0-9)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Kategori</label>
                    <select class="filter-select" id="categoryFilter">
                        <option value="">TÃ¼m Kategoriler</option>
                        <option value="motor">Motor ParÃ§alarÄ±</option>
                        <option value="fren">Fren Sistemi</option>
                        <option value="elektrik">Elektrik Sistemi</option>
                        <option value="suspansiyon">SÃ¼spansiyon</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">SÄ±ralama</label>
                    <select class="filter-select" id="sortFilter">
                        <option value="code_asc">Koda GÃ¶re (A-Z)</option>
                        <option value="code_desc">Koda GÃ¶re (Z-A)</option>
                        <option value="name_asc">Ada GÃ¶re (A-Z)</option>
                        <option value="stock_desc">StoÄŸa GÃ¶re (Ã‡ok-Az)</option>
                    </select>
                </div>
            </div>

            <!-- QUICK ACTIONS -->
            <div class="quick-actions">
                <button class="action-btn" onclick="loadAllProducts()">
                    <i class="fas fa-sync-alt"></i> TÃ¼mÃ¼nÃ¼ YÃ¼kle
                </button>
                <button class="action-btn" onclick="refreshProducts()">
                    <i class="fas fa-redo"></i> Yenile
                </button>
                <button class="action-btn" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> Excel'e Aktar
                </button>
                <button class="action-btn primary" onclick="addNewProduct()">
                    <i class="fas fa-plus"></i> Yeni Malzeme
                </button>
            </div>
        </div>

        <!-- PRODUCTS TABLE SECTION -->
        <div class="table-section">
            <!-- TABLE HEADER -->
            <div class="table-header">
                <div class="table-header-row">
                    <div class="table-header-cell"></div>
                    <div class="table-header-cell">Malzeme Kodu</div>
                    <div class="table-header-cell">ÃœrÃ¼n AdÄ±</div>
                    <div class="table-header-cell">OEM Kodu</div>
                    <div class="table-header-cell">Ãœretici</div>
                    <div class="table-header-cell">Stok Durumu</div>
                    <div class="table-header-cell">Fiyat (â‚º)</div>
                    <div class="table-header-cell">Ä°skonto</div>
                    <div class="table-header-cell">Aktif</div>
                    <div class="table-header-cell">Ä°ÅŸlemler</div>
                </div>
            </div>

            <!-- PRODUCTS TABLE -->
            <div class="products-table-container">
                <div class="products-table-wrapper">
                    <table class="products-table" id="productsTable">
                        <tbody id="productsTableBody">
                            <tr>
                                <td colspan="10" class="loading-row">
                                    <div class="loading-content">
                                        <div class="spinner"></div>
                                        <span>Malzemeler yÃ¼kleniyor...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- PAGINATION -->
            <div class="pagination">
                <div class="pagination-info" id="paginationInfo">
                    Sayfa 1 / 1 - Toplam 0 kayÄ±t (0 Ã¼rÃ¼n bulundu)
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="prevPage" onclick="changePage(-1)" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="page-numbers" id="pageNumbers"></div>
                    <button class="pagination-btn" id="nextPage" onclick="changePage(1)" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- EDIT PRODUCT MODAL -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-edit"></i>
                    <span id="modalProductCode">ÃœrÃ¼n Kodu</span> - DÃ¼zenle
                </div>
                <button class="modal-close" onclick="closeEditModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="modal-grid">
                    <!-- LEFT COLUMN -->
                    <div>
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-info-circle"></i>
                                Temel Bilgiler
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÃœrÃ¼n Kodu</label>
                                <input type="text" class="form-control" id="modalCode" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÃœrÃ¼n AdÄ±</label>
                                <input type="text" class="form-control" id="modalName">
                            </div>
                            <div class="form-group">
                                <label class="form-label">OEM Kodu</label>
                                <input type="text" class="form-control" id="modalOem">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ãœretici</label>
                                <select class="form-control" id="modalManufacturer">
                                    <option value="bosch">Bosch</option>
                                    <option value="makita">Makita</option>
                                    <option value="dewalt">DeWalt</option>
                                    <option value="stanley">Stanley</option>
                                    <option value="bmw">BMW</option>
                                    <option value="mercedes">Mercedes</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-box"></i>
                                Stok AyarlarÄ±
                            </div>
                            <div class="form-group">
                                <label class="form-label">Minimum Stok UyarÄ±sÄ±</label>
                                <input type="number" class="form-control" id="modalMinStock" min="0" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Maksimum Stok</label>
                                <input type="number" class="form-control" id="modalMaxStock" min="0" value="100">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stok GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼</label>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>Stok miktarÄ±nÄ± gÃ¶ster</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="modalShowStock" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RIGHT COLUMN -->
                    <div>
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-tag"></i>
                                Fiyat ve Ä°skonto
                            </div>
                            <div class="form-group">
                                <label class="form-label">Birim Fiyat (â‚º)</label>
                                <input type="number" class="form-control" id="modalPrice" min="0" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Temel Ä°skonto (%)</label>
                                <div class="range-container">
                                    <input type="range" style="flex: 1;" min="0" max="50" value="10" id="modalDiscount" oninput="updateModalRangeValue(this, 'modalDiscountValue')">
                                    <span id="modalDiscountValue" class="range-value">10</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Kampanya Ä°skontosu (%)</label>
                                <div class="range-container">
                                    <input type="range" style="flex: 1;" min="0" max="70" value="0" id="modalCampaignDiscount" oninput="updateModalRangeValue(this, 'modalCampaignDiscountValue')">
                                    <span id="modalCampaignDiscountValue" class="range-value">0</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fiyat GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼</label>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>FiyatÄ± gÃ¶ster</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="modalShowPrice" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-eye"></i>
                                GÃ¶rÃ¼nÃ¼rlÃ¼k AyarlarÄ±
                            </div>
                            <div class="form-group">
                                <label class="form-label" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>Adet GÃ¶ster</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="modalShowQuantity" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>ÃœrÃ¼nÃ¼ Aktif Yap</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="modalActive" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>KampanyalÄ± ÃœrÃ¼n</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="modalIsCampaign">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ADDITIONAL SETTINGS -->
                <div class="modal-section">
                    <div class="modal-section-title">
                        <i class="fas fa-cogs"></i>
                        Ek Ayarlar
                    </div>
                    <div class="form-group">
                        <label class="form-label">AÃ§Ä±klama</label>
                        <textarea class="form-control" id="modalDescription" rows="3" placeholder="ÃœrÃ¼n aÃ§Ä±klamasÄ±..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ã–zel Not (Sadece admin gÃ¶rÃ¼r)</label>
                        <textarea class="form-control" id="modalAdminNote" rows="2" placeholder="Admin notu..."></textarea>
                    </div>
                </div>
                
                <!-- SAVE BUTTONS -->
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> Ä°ptal
                    </button>
                    <button class="btn btn-primary" onclick="saveProductChanges()">
                        <i class="fas fa-save"></i> DeÄŸiÅŸiklikleri Kaydet
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====================================================
        // ðŸš€ GLOBAL VARIABLES
        // ====================================================
        let allProducts = [];
        let filteredProducts = [];
        let currentPage = 1;
        const pageSize = 50; // ArtÄ±rÄ±ldÄ±: 20'den 50'ye Ã§Ä±karÄ±ldÄ±
        let totalPages = 1;
        let totalRecords = 0;
        let editingProduct = null;

        // ====================================================
        // ðŸš€ HELPER FUNCTIONS (BASE64 DESTEKLÄ°)
        // ====================================================
        function encodeUserDataToBase64(userData) {
            try {
                const jsonString = JSON.stringify(userData);
                return btoa(unescape(encodeURIComponent(jsonString)));
            } catch (error) {
                console.error('Base64 encode hatasÄ±:', error);
                return '';
            }
        }

        function setAuthHeaders(headers = {}) {
            try {
                const userDataString = localStorage.getItem('b2b_user_data');
                if (userDataString) {
                    const userData = JSON.parse(userDataString);
                    const userDataBase64 = encodeUserDataToBase64(userData);
                    
                    return {
                        ...headers,
                        'Content-Type': 'application/json',
                        'x-user-data-base64': userDataBase64,
                        'x-user-type': 'admin'
                    };
                }
                return headers;
            } catch (error) {
                console.error('Auth header oluÅŸturma hatasÄ±:', error);
                return headers;
            }
        }

        function showMessage(message, type = 'info') {
            if (window.parent && window.parent.showNotification) {
                window.parent.showNotification(message, type);
            } else if (window.top && window.top.showNotification) {
                window.top.showNotification(message, type);
            } else {
                console.log(`${type.toUpperCase()}: ${message}`);
                alert(message);
            }
        }

        // ====================================================
        // ðŸš€ INITIALIZATION
        // ====================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Malzeme YÃ¶netimi baÅŸlatÄ±lÄ±yor...');
            initializeApp();
        });

        function initializeApp() {
            try {
                // Event listener'larÄ± kur
                setupEventListeners();
                
                // GerÃ§ek verileri API'den yÃ¼kle
                loadRealProducts();
                
                console.log('âœ… Malzeme YÃ¶netimi hazÄ±r!');
                
            } catch (error) {
                console.error('Uygulama baÅŸlatma hatasÄ±:', error);
                showMessage('Sistem baÅŸlatÄ±lamadÄ±: ' + error.message, 'error');
            }
        }

        // ====================================================
        // ðŸš€ SETUP FUNCTIONS
        // ====================================================
        function setupEventListeners() {
            // Arama input'u - Enter tuÅŸu
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchProducts();
                }
            });
            
            // Filtre deÄŸiÅŸiklikleri
            document.getElementById('manufacturerFilter').addEventListener('change', applyFilters);
            document.getElementById('stockFilter').addEventListener('change', applyFilters);
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('sortFilter').addEventListener('change', applyFilters);
        }

        // ====================================================
        // ðŸš€ REAL DATA LOADING FROM API - TÃœM ÃœRÃœNLER Ä°Ã‡Ä°N GÃœNCELLENDÄ°
        // ====================================================
        async function loadRealProducts() {
            console.log('ðŸ”„ API\'den TÃœM Ã¼rÃ¼nler yÃ¼kleniyor...');
            
            try {
                // Loading gÃ¶ster
                document.getElementById('productsTableBody').innerHTML = `
                    <tr>
                        <td colspan="10" class="loading-row">
                            <div class="loading-content">
                                <div class="spinner"></div>
                                <span>API'den tÃ¼m Ã¼rÃ¼nler yÃ¼kleniyor...</span>
                            </div>
                        </td>
                    </tr>
                `;
                
                // Auth headers'larÄ± hazÄ±rla
                const headers = setAuthHeaders();
                
                // Ä°lk API Ã§aÄŸrÄ±sÄ±: TÃ¼m Ã¼rÃ¼nleri al (limit 1000)
                const response = await fetch('http://192.168.219.128:8080/api/b2b/admin/products?limit=1000&offset=0', {
                    headers: headers
                });
                
                if (!response.ok) {
                    throw new Error(`API hatasÄ±: ${response.status} ${response.statusText}`);
                }
                
                const result = await response.json();
                
                // API yanÄ±tÄ±nÄ± kontrol et
                if (!result.success) {
                    throw new Error(result.error || result.message || 'API baÅŸarÄ±sÄ±z');
                }
                
                // API'den gelen verileri iÅŸle
                const apiProducts = result.data || [];
                const pagination = result.pagination || {};
                console.log(`âœ… API'den ${apiProducts.length} Ã¼rÃ¼n alÄ±ndÄ± (Toplam: ${pagination.total || apiProducts.length})`);
                
                // EÄŸer pagination varsa ve daha fazla Ã¼rÃ¼n varsa, hepsini al
                if (pagination.hasMore && pagination.total > apiProducts.length) {
                    const totalToFetch = pagination.total;
                    const batchSize = 1000;
                    const batches = Math.ceil(totalToFetch / batchSize);
                    
                    let allApiProducts = [...apiProducts];
                    
                    // Kalan Ã¼rÃ¼nleri getir
                    for (let i = 1; i < batches; i++) {
                        const offset = i * batchSize;
                        console.log(`ðŸ”„ Ek Ã¼rÃ¼nler yÃ¼kleniyor: Batch ${i+1}, Offset: ${offset}`);
                        
                        try {
                            const batchResponse = await fetch(`http://192.168.219.128:8080/api/b2b/admin/products?limit=${batchSize}&offset=${offset}`, {
                                headers: headers
                            });
                            
                            if (batchResponse.ok) {
                                const batchResult = await batchResponse.json();
                                if (batchResult.success && batchResult.data) {
                                    allApiProducts = [...allApiProducts, ...batchResult.data];
                                    console.log(`âœ… Batch ${i+1}: ${batchResult.data.length} Ã¼rÃ¼n eklendi (Toplam: ${allApiProducts.length})`);
                                }
                            }
                        } catch (batchError) {
                            console.warn(`Batch ${i+1} hatasÄ±:`, batchError);
                        }
                    }
                    
                    console.log(`ðŸŽ‰ TÃ¼m Ã¼rÃ¼nler alÄ±ndÄ±: ${allApiProducts.length} Ã¼rÃ¼n`);
                    processApiProducts(allApiProducts);
                    
                } else {
                    processApiProducts(apiProducts);
                }
                
            } catch (error) {
                console.error('âŒ API yÃ¼kleme hatasÄ±:', error);
                
                // Hata durumunda test verilerine geÃ§
                loadFallbackTestData();
                showMessage(`API hatasÄ±: ${error.message}. Test verileri yÃ¼klendi.`, 'warning');
            }
        }

        function processApiProducts(apiProducts) {
            console.log(`ðŸ“Š API verileri iÅŸleniyor: ${apiProducts.length} Ã¼rÃ¼n`);
            
            // API verilerini uygulama formatÄ±na Ã§evir
            allProducts = apiProducts.map(product => {
                // Stok bilgilerini gÃ¼venli bir ÅŸekilde al
                const stock = product.stock || {};
                const totalStock = parseInt(stock.total) || 0;
                const centralStock = parseInt(stock.merkez) || 0;
                const ikitelliStock = parseInt(stock.ikitelli) || 0;
                const bostanciStock = parseInt(stock.bostanci) || 0;
                const depotStock = parseInt(stock.depot) || 0;
                
                return {
                    id: product.id || product.logicalref,
                    code: product.code || product.productCode || '',
                    name: product.name || product.productName || '',
                    manufacturer: product.manufacturer || product.stgrpcode || '',
                    category: product.category || product.cyphcode || 'Genel',
                    price: {
                        original: product.price?.original || product.unitPrice || product.unitprice || 0,
                        currency: product.price?.currency || product.currencyCode || 160
                    },
                    stock: {
                        total: totalStock,
                        merkez: centralStock,
                        ikitelli: ikitelliStock,
                        bostanci: bostanciStock,
                        depot: depotStock
                    },
                    active: product.active !== false && product.isActive !== 0,
                    oemCode: product.oemCode || product.producercode || '',
                    hasCampaign: product.hasCampaign || false,
                    globalDiscount: product.globalDiscount || product.totalDiscountRate || 10,
                    discounts: product.discounts || [],
                    minQuantity: product.minQuantity || 1,
                    vehicleModel: product.vehicleModel || product.specode || '',
                    shelves: product.shelves || {},
                    settings: product.settings || {
                        showPrice: true,
                        showStock: true,
                        showQuantity: true,
                        minStockAlert: 5,
                        maxStock: 100
                    },
                    productCode: product.productCode || product.code,
                    productName: product.productName || product.name,
                    currency: product.currency || 'TL',
                    currencyCode: product.currencyCode || 160,
                    finalPrice: product.finalPrice || product.price?.original || 0,
                    totalDiscountRate: product.totalDiscountRate || product.globalDiscount || 10,
                    calculationMethod: product.calculationMethod || 'MANUAL',
                    description: product.description || ''
                };
            });
            
            totalRecords = allProducts.length;
            
            // Ä°statistikleri gÃ¼ncelle
            updateStatistics();
            
            // Filtreleri uygula
            applyFilters();
            
            // BaÅŸarÄ± mesajÄ±
            showMessage(`${allProducts.length} Ã¼rÃ¼n baÅŸarÄ±yla yÃ¼klendi`, 'success');
        }

        function loadFallbackTestData() {
            console.log('ðŸ”„ Test verileri yÃ¼kleniyor...');
            
            // GeniÅŸletilmiÅŸ test verileri (500 Ã¼rÃ¼n)
            const testProducts = [];
            const manufacturers = ['Bosch', 'Makita', 'DeWalt', 'Stanley', 'BMW', 'Mercedes', 'Audi', 'Volkswagen'];
            const categories = ['Motor ParÃ§alarÄ±', 'Fren Sistemi', 'Elektrik Sistemi', 'SÃ¼spansiyon', 'DÄ±ÅŸ Aksam', 'Ä°Ã§ Aksam'];
            
            for (let i = 1; i <= 500; i++) {
                const manufacturer = manufacturers[Math.floor(Math.random() * manufacturers.length)];
                const category = categories[Math.floor(Math.random() * categories.length)];
                
                // Rastgele stok deÄŸerleri
                const totalStock = Math.floor(Math.random() * 500) + 1;
                const centralStock = Math.floor(Math.random() * totalStock);
                const remaining = totalStock - centralStock;
                const ikitelliStock = Math.floor(Math.random() * remaining);
                const bostanciStock = Math.floor(Math.random() * (remaining - ikitelliStock));
                const depotStock = remaining - ikitelliStock - bostanciStock;
                
                testProducts.push({
                    code: `URUN-${i.toString().padStart(6, '0')}`,
                    name: `${manufacturer} ${category} ÃœrÃ¼nÃ¼ ${i}`,
                    manufacturer: manufacturer,
                    category: category,
                    price: { 
                        original: Math.floor(Math.random() * 5000) + 100, 
                        currency: 160 
                    },
                    stock: { 
                        total: totalStock,
                        merkez: centralStock,
                        ikitelli: ikitelliStock,
                        bostanci: bostanciStock,
                        depot: depotStock
                    },
                    active: Math.random() > 0.1, // %90 aktif
                    oemCode: `OEM-${Math.floor(Math.random() * 100000).toString().padStart(6, '0')}`,
                    hasCampaign: i % 7 === 0,
                    globalDiscount: [5, 10, 15, 20][Math.floor(Math.random() * 4)],
                    discounts: [[5, 10], [10, 5], [15], [20]][Math.floor(Math.random() * 4)],
                    minQuantity: 1,
                    vehicleModel: ['Sedan', 'Hatchback', 'SUV', 'Pickup'][Math.floor(Math.random() * 4)],
                    shelves: {
                        central: 'A' + Math.floor(Math.random() * 10),
                        bostanci: 'B' + Math.floor(Math.random() * 10),
                        ikitelli: 'C' + Math.floor(Math.random() * 10)
                    },
                    settings: {
                        showPrice: true,
                        showStock: true,
                        showQuantity: true,
                        minStockAlert: 5,
                        maxStock: 100
                    },
                    description: `${manufacturer} marka ${category.toLowerCase()} iÃ§in yÃ¼ksek kaliteli orijinal Ã¼rÃ¼n.`
                });
            }
            
            allProducts = testProducts;
            totalRecords = allProducts.length;
            
            // Ä°statistikleri gÃ¼ncelle
            updateStatistics();
            
            // Filtreleri uygula
            applyFilters();
        }

        function updateStatistics() {
            const totalProducts = allProducts.length;
            const activeProducts = allProducts.filter(p => p.active).length;
            const totalStock = allProducts.reduce((sum, p) => sum + (p.stock?.total || 0), 0);
            
            document.getElementById('totalProductsCount').textContent = `${totalProducts} Ã¼rÃ¼n`;
            
            // Ä°statistik badge'ini gÃ¼ncelle
            const badge = document.getElementById('statisticsBadge');
            badge.innerHTML = `
                <i class="fas fa-chart-bar"></i>
                <span>${totalProducts} Ã¼rÃ¼n</span>
                <span style="margin-left: 8px; opacity: 0.9; font-size: 0.8rem;">
                    ${activeProducts} aktif â€¢ ${totalStock} toplam stok
                </span>
            `;
        }

        // ====================================================
        // ðŸš€ UI FUNCTIONS
        // ====================================================
        function searchProducts() {
            applyFilters();
        }

        function loadAllProducts() {
            document.getElementById('searchInput').value = '';
            document.getElementById('manufacturerFilter').value = '';
            document.getElementById('stockFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('sortFilter').value = 'code_asc';
            
            applyFilters();
            showMessage('TÃ¼m Ã¼rÃ¼nler yÃ¼klendi', 'success');
        }

        function refreshProducts() {
            loadRealProducts();
        }

        function exportToExcel() {
            showMessage('Excel export Ã¶zelliÄŸi yakÄ±nda eklenecek', 'info');
        }

        function addNewProduct() {
            // Modal'Ä± yeni Ã¼rÃ¼n iÃ§in hazÄ±rla
            document.getElementById('modalProductCode').textContent = 'YENÄ° ÃœRÃœN';
            document.getElementById('modalCode').value = '';
            document.getElementById('modalCode').readOnly = false;
            document.getElementById('modalName').value = '';
            document.getElementById('modalOem').value = '';
            document.getElementById('modalManufacturer').value = 'bosch';
            document.getElementById('modalPrice').value = 0;
            document.getElementById('modalMinStock').value = 5;
            document.getElementById('modalMaxStock').value = 100;
            document.getElementById('modalDiscount').value = 10;
            document.getElementById('modalDiscountValue').textContent = '10';
            document.getElementById('modalCampaignDiscount').value = 0;
            document.getElementById('modalCampaignDiscountValue').textContent = '0';
            document.getElementById('modalShowPrice').checked = true;
            document.getElementById('modalShowStock').checked = true;
            document.getElementById('modalShowQuantity').checked = true;
            document.getElementById('modalActive').checked = true;
            document.getElementById('modalIsCampaign').checked = false;
            document.getElementById('modalDescription').value = '';
            document.getElementById('modalAdminNote').value = '';
            
            editingProduct = null;
            document.getElementById('editModal').classList.add('active');
        }

        function editProduct(productCode) {
            const product = allProducts.find(p => p.code === productCode);
            if (!product) return;
            
            editingProduct = product;
            
            // Modal'Ä± doldur
            document.getElementById('modalProductCode').textContent = product.code;
            document.getElementById('modalCode').value = product.code;
            document.getElementById('modalCode').readOnly = true;
            document.getElementById('modalName').value = product.name;
            document.getElementById('modalOem').value = product.oemCode || '';
            document.getElementById('modalManufacturer').value = product.manufacturer.toLowerCase() || 'bosch';
            document.getElementById('modalPrice').value = product.price?.original || 0;
            document.getElementById('modalMinStock').value = product.settings?.minStockAlert || 5;
            document.getElementById('modalMaxStock').value = product.settings?.maxStock || 100;
            document.getElementById('modalDiscount').value = product.globalDiscount || 10;
            document.getElementById('modalDiscountValue').textContent = product.globalDiscount || 10;
            document.getElementById('modalCampaignDiscount').value = product.hasCampaign ? (product.campaignDiscount || 20) : 0;
            document.getElementById('modalCampaignDiscountValue').textContent = product.hasCampaign ? (product.campaignDiscount || '20') : '0';
            document.getElementById('modalShowPrice').checked = product.settings?.showPrice !== false;
            document.getElementById('modalShowStock').checked = product.settings?.showStock !== false;
            document.getElementById('modalShowQuantity').checked = product.settings?.showQuantity !== false;
            document.getElementById('modalActive').checked = product.active !== false;
            document.getElementById('modalIsCampaign').checked = product.hasCampaign || false;
            document.getElementById('modalDescription').value = product.description || '';
            document.getElementById('modalAdminNote').value = product.adminNote || '';
            
            // Modal'Ä± gÃ¶ster
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            editingProduct = null;
        }

        async function saveProductChanges() {
            const productCode = document.getElementById('modalCode').value;
            if (!productCode && !editingProduct) {
                showMessage('ÃœrÃ¼n kodu gereklidir', 'error');
                return;
            }
            
            try {
                // DeÄŸiÅŸiklikleri topla
                const changes = {
                    code: productCode,
                    name: document.getElementById('modalName').value,
                    oemCode: document.getElementById('modalOem').value,
                    manufacturer: document.getElementById('modalManufacturer').value,
                    price: parseFloat(document.getElementById('modalPrice').value) || 0,
                    globalDiscount: parseInt(document.getElementById('modalDiscount').value) || 0,
                    hasCampaign: document.getElementById('modalIsCampaign').checked,
                    campaignDiscount: parseInt(document.getElementById('modalCampaignDiscount').value) || 0,
                    active: document.getElementById('modalActive').checked,
                    settings: {
                        showPrice: document.getElementById('modalShowPrice').checked,
                        showStock: document.getElementById('modalShowStock').checked,
                        showQuantity: document.getElementById('modalShowQuantity').checked,
                        minStockAlert: parseInt(document.getElementById('modalMinStock').value) || 5,
                        maxStock: parseInt(document.getElementById('modalMaxStock').value) || 100
                    },
                    description: document.getElementById('modalDescription').value,
                    adminNote: document.getElementById('modalAdminNote').value
                };
                
                // Backend'e kaydet
                await saveProductToBackend(changes);
                
                if (editingProduct) {
                    // GÃ¼ncelleme
                    const productIndex = allProducts.findIndex(p => p.code === editingProduct.code);
                    if (productIndex > -1) {
                        allProducts[productIndex] = { ...allProducts[productIndex], ...changes };
                    }
                } else {
                    // Yeni ekleme
                    allProducts.unshift({
                        ...changes,
                        id: Date.now(),
                        stock: { total: 0, merkez: 0, ikitelli: 0, bostanci: 0, depot: 0 },
                        category: 'Genel',
                        minQuantity: 1,
                        discounts: [changes.globalDiscount],
                        productCode: changes.code,
                        productName: changes.name,
                        currency: 'TL',
                        currencyCode: 160,
                        finalPrice: changes.price,
                        totalDiscountRate: changes.globalDiscount,
                        vehicleModel: '',
                        shelves: {}
                    });
                    totalRecords = allProducts.length;
                }
                
                // Ä°statistikleri gÃ¼ncelle
                updateStatistics();
                
                // Tabloyu gÃ¼ncelle
                applyFilters();
                
                // Modal'Ä± kapat
                closeEditModal();
                
                // BaÅŸarÄ± mesajÄ±
                showMessage(`"${changes.code}" Ã¼rÃ¼nÃ¼ baÅŸarÄ±yla ${editingProduct ? 'gÃ¼ncellendi' : 'eklendi'}`, 'success');
                
            } catch (error) {
                console.error('ÃœrÃ¼n kaydetme hatasÄ±:', error);
                showMessage(`ÃœrÃ¼n kaydedilemedi: ${error.message}`, 'error');
            }
        }

        async function saveProductToBackend(productData) {
            try {
                // Backend API'ye kayÄ±t yap
                const response = await fetch('http://192.168.219.128:8080/api/b2b/admin/save-product', {
                    method: 'POST',
                    headers: setAuthHeaders(),
                    body: JSON.stringify(productData)
                });
                
                if (!response.ok) {
                    throw new Error(`API hatasÄ±: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || result.message || 'KayÄ±t baÅŸarÄ±sÄ±z');
                }
                
                console.log('âœ… ÃœrÃ¼n backend\'e kaydedildi:', result);
                return result;
                
            } catch (error) {
                console.error('âŒ Backend kaydetme hatasÄ±:', error);
                throw error;
            }
        }

        function toggleProductActive(productCode, isActive) {
            const product = allProducts.find(p => p.code === productCode);
            if (product) {
                const oldStatus = product.active;
                product.active = isActive;
                
                // Backend'e gÃ¼ncelle
                updateProductStatusInBackend(productCode, isActive)
                    .then(() => {
                        showMessage(`ÃœrÃ¼n ${isActive ? 'aktif' : 'pasif'} yapÄ±ldÄ±`, 'success');
                        applyFilters();
                    })
                    .catch(error => {
                        console.error('Durum gÃ¼ncelleme hatasÄ±:', error);
                        showMessage(`Durum gÃ¼ncellenemedi: ${error.message}`, 'error');
                        // Geri al
                        product.active = oldStatus;
                        applyFilters();
                    });
            }
        }

        async function updateProductStatusInBackend(productCode, isActive) {
            try {
                const response = await fetch('http://192.168.219.128:8080/api/b2b/admin/update-product-status', {
                    method: 'POST',
                    headers: setAuthHeaders(),
                    body: JSON.stringify({
                        productCode: productCode,
                        active: isActive
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API hatasÄ±: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || result.message || 'Durum gÃ¼ncelleme baÅŸarÄ±sÄ±z');
                }
                
                console.log('âœ… ÃœrÃ¼n durumu gÃ¼ncellendi:', result);
                return result;
                
            } catch (error) {
                console.error('âŒ Durum gÃ¼ncelleme hatasÄ±:', error);
                throw error;
            }
        }

        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updateProductTable();
                updatePagination();
            }
        }

        function goToPage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updateProductTable();
                updatePagination();
            }
        }

        // ====================================================
        // ðŸš€ UTILITY FUNCTIONS
        // ====================================================
        function updateModalRangeValue(input, valueSpanId) {
            const valueSpan = document.getElementById(valueSpanId);
            if (valueSpan) {
                valueSpan.textContent = input.value;
            }
        }

        // ====================================================
        // ðŸš€ FILTERING
        // ====================================================
        function applyFilters() {
            console.log('ðŸ” Filtreleme uygulanÄ±yor...');
            
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const manufacturer = document.getElementById('manufacturerFilter').value.toLowerCase();
            const stockFilter = document.getElementById('stockFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;
            
            // TÃ¼m filtreleri uygula
            filteredProducts = allProducts.filter(product => {
                if (!product) return false;
                
                // Arama filtresi (malzeme kodu, OEM kodu, Ã¼retici kodu ve aÃ§Ä±klamada ara)
                const matchesSearch = !searchTerm || 
                    (product.code && product.code.toString().toLowerCase().includes(searchTerm)) ||
                    (product.oemCode && product.oemCode.toString().toLowerCase().includes(searchTerm)) ||
                    (product.manufacturer && product.manufacturer.toString().toLowerCase().includes(searchTerm)) ||
                    (product.name && product.name.toString().toLowerCase().includes(searchTerm)) ||
                    (product.description && product.description.toString().toLowerCase().includes(searchTerm));
                
                // Ãœretici filtresi
                const matchesManufacturer = !manufacturer || 
                    (product.manufacturer && product.manufacturer.toString().toLowerCase().includes(manufacturer));
                
                // Kategori filtresi
                const matchesCategory = !category || 
                    (product.category && product.category.toString().toLowerCase().includes(category.toLowerCase()));
                
                // Stok filtresi
                let matchesStock = true;
                if (stockFilter) {
                    const totalStock = product.stock?.total || 0;
                    if (stockFilter === 'high') matchesStock = totalStock >= 50;
                    else if (stockFilter === 'medium') matchesStock = totalStock >= 10 && totalStock < 50;
                    else if (stockFilter === 'low') matchesStock = totalStock < 10;
                }
                
                return matchesSearch && matchesManufacturer && matchesCategory && matchesStock;
            });
            
            console.log(`ðŸ“Š Filtre sonucu: ${filteredProducts.length} Ã¼rÃ¼n`);
            
            // SÄ±ralama uygula
            filteredProducts = sortProducts(filteredProducts, sortFilter);
            
            // Toplam kayÄ±t sayÄ±sÄ±nÄ± gÃ¼ncelle
            totalRecords = filteredProducts.length;
            
            // Toplam sayfa sayÄ±sÄ±nÄ± hesapla
            totalPages = Math.max(1, Math.ceil(filteredProducts.length / pageSize));
            
            // Ä°lk sayfaya dÃ¶n
            currentPage = 1;
            
            // Tabloyu gÃ¼ncelle
            updateProductTable();
            updatePagination();
        }

        function sortProducts(products, sortType) {
            const sorted = [...products];
            
            switch(sortType) {
                case 'code_asc':
                    return sorted.sort((a, b) => (a.code || '').localeCompare(b.code || ''));
                case 'code_desc':
                    return sorted.sort((a, b) => (b.code || '').localeCompare(a.code || ''));
                case 'name_asc':
                    return sorted.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
                case 'stock_desc':
                    return sorted.sort((a, b) => (b.stock?.total || 0) - (a.stock?.total || 0));
                default:
                    return sorted;
            }
        }

        // ====================================================
        // ðŸš€ TABLE FUNCTIONS - GÃœNCELLENMÄ°Åž STOK GÃ–STERÄ°MÄ°
        // ====================================================
        function updateProductTable() {
            const tbody = document.getElementById('productsTableBody');
            
            if (!filteredProducts || filteredProducts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-row">
                            <div class="empty-content">
                                <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <span>Filtrelere uygun Ã¼rÃ¼n bulunamadÄ±</span>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sayfa verilerini al
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageProducts = filteredProducts.slice(startIndex, endIndex);
            
            // HTML oluÅŸtur
            tbody.innerHTML = pageProducts.map((product) => {
                const stock = product.stock || {};
                const totalStock = stock.total || 0;
                const merkezStock = stock.merkez || 0;
                const ikitelliStock = stock.ikitelli || 0;
                const bostanciStock = stock.bostanci || 0;
                const depotStock = stock.depot || 0;
                
                const stockClass = getStockClass(totalStock);
                
                return `
                <tr>
                    <td style="text-align: center;">
                        <div style="width: 32px; height: 32px; background: #e2e8f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-box" style="color: #64748b;"></i>
                        </div>
                    </td>
                    <td>
                        <div class="product-code">${product.code || '-'}</div>
                    </td>
                    <td>
                        <div class="product-name">${product.name || 'Ä°simsiz ÃœrÃ¼n'}</div>
                    </td>
                    <td>${product.oemCode || '-'}</td>
                    <td><span class="manufacturer-badge">${product.manufacturer || '-'}</span></td>
                    <td>
                        <div class="stock-info ${stockClass}">
                            <!-- AyrÄ±ntÄ±lÄ± Stok Bilgileri -->
                            <div class="stock-location">
                                <span class="location-name">Merkez:</span>
                                <span class="location-value">${merkezStock}</span>
                            </div>
                            <div class="stock-location">
                                <span class="location-name">Ä°kitelli:</span>
                                <span class="location-value">${ikitelliStock}</span>
                            </div>
                            <div class="stock-location">
                                <span class="location-name">BostancÄ±:</span>
                                <span class="location-value">${bostanciStock}</span>
                            </div>
                            <div class="stock-location">
                                <span class="location-name">Depo:</span>
                                <span class="location-value">${depotStock}</span>
                            </div>
                            <!-- Toplam Stok -->
                            <div class="stock-summary">
                                <span class="stock-total">Toplam:</span>
                                <span class="stock-count">${totalStock}</span>
                            </div>
                        </div>
                    </td>
                    <td class="price-info">
                        <div class="price-value">
                            ${formatPrice(product.price?.original || 0)} â‚º
                        </div>
                    </td>
                    <td class="discount-info">
                        <div class="discount-badges">
                            ${getDiscountBadges(product)}
                        </div>
                    </td>
                    <td>
                        <label class="toggle-switch">
                            <input type="checkbox" ${product.active ? 'checked' : ''} 
                                   onchange="toggleProductActive('${product.code}', this.checked)" 
                                   onclick="event.stopPropagation()">
                            <span class="toggle-slider"></span>
                        </label>
                    </td>
                    <td>
                        <div class="product-actions">
                            <button class="action-btn-small edit" title="DÃ¼zenle" onclick="editProduct('${product.code}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn-small settings" title="Detaylar" onclick="showProductDetails('${product.code}')">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            }).join('');
        }

        function getDiscountBadges(product) {
            const discounts = product.discounts || [];
            if (!discounts.length && product.globalDiscount) {
                discounts.push(product.globalDiscount);
            }
            
            if (product.hasCampaign && product.campaignDiscount) {
                discounts.push(product.campaignDiscount);
            }
            
            if (!discounts.length) return '-';
            
            return discounts.map(rate => {
                let discountClass = 'discount-other';
                if (rate <= 10) discountClass = 'discount-5';
                else if (rate <= 20) discountClass = 'discount-10';
                else if (rate <= 30) discountClass = 'discount-20';
                
                return `<div class="discount-badge ${discountClass}">%${rate}</div>`;
            }).join('');
        }

        function getStockClass(stock) {
            if (stock >= 50) return 'stock-high';
            if (stock >= 10) return 'stock-medium';
            return 'stock-low';
        }

        function showProductDetails(productCode) {
            const product = allProducts.find(p => p.code === productCode);
            if (!product) return;
            
            const details = `
                <strong>ÃœrÃ¼n Kodu:</strong> ${product.code}<br>
                <strong>ÃœrÃ¼n AdÄ±:</strong> ${product.name}<br>
                <strong>OEM Kodu:</strong> ${product.oemCode || '-'}<br>
                <strong>Ãœretici:</strong> ${product.manufacturer}<br>
                <strong>Kategori:</strong> ${product.category || '-'}<br>
                <strong>Stoklar:</strong><br>
                &nbsp;&nbsp;â€¢ Merkez: ${product.stock?.merkez || 0}<br>
                &nbsp;&nbsp;â€¢ Ä°kitelli: ${product.stock?.ikitelli || 0}<br>
                &nbsp;&nbsp;â€¢ BostancÄ±: ${product.stock?.bostanci || 0}<br>
                &nbsp;&nbsp;â€¢ Depo: ${product.stock?.depot || 0}<br>
                &nbsp;&nbsp;â€¢ Toplam: <strong>${product.stock?.total || 0}</strong><br>
                <strong>Fiyat:</strong> ${formatPrice(product.price?.original || 0)} â‚º<br>
                <strong>Durum:</strong> ${product.active ? 'Aktif' : 'Pasif'}
            `;
            
            alert(details);
        }

        // ====================================================
        // ðŸš€ PAGINATION
        // ====================================================
        function updatePagination() {
            const infoElement = document.getElementById('paginationInfo');
            const prevButton = document.getElementById('prevPage');
            const nextButton = document.getElementById('nextPage');
            const pageNumbersElement = document.getElementById('pageNumbers');
            
            if (filteredProducts.length === 0) {
                infoElement.textContent = 'Sayfa 0 / 0 - Toplam 0 kayÄ±t (0 Ã¼rÃ¼n bulundu)';
                prevButton.disabled = true;
                nextButton.disabled = true;
                pageNumbersElement.innerHTML = '';
                return;
            }
            
            const startRecord = (currentPage - 1) * pageSize + 1;
            const endRecord = Math.min(currentPage * pageSize, filteredProducts.length);
            
            infoElement.textContent = `Sayfa ${currentPage} / ${totalPages} - KayÄ±t ${startRecord}-${endRecord} / ${filteredProducts.length} (Toplam: ${totalRecords} Ã¼rÃ¼n)`;
            prevButton.disabled = currentPage === 1;
            nextButton.disabled = currentPage === totalPages;
            
            // Sayfa numaralarÄ±nÄ± oluÅŸtur
            let pageNumbersHTML = '';
            const maxPagesToShow = 7;
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
            
            if (endPage - startPage + 1 < maxPagesToShow) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }
            
            // Ä°lk sayfa
            if (startPage > 1) {
                pageNumbersHTML += '<div class="page-number" onclick="goToPage(1)">1</div>';
                if (startPage > 2) {
                    pageNumbersHTML += '<div class="page-number" style="cursor: default; background: none;">...</div>';
                }
            }
            
            // Sayfa numaralarÄ±
            for (let i = startPage; i <= endPage; i++) {
                pageNumbersHTML += '<div class="page-number ' + (i === currentPage ? 'active' : '') + '" onclick="goToPage(' + i + ')">' + i + '</div>';
            }
            
            // Son sayfa
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pageNumbersHTML += '<div class="page-number" style="cursor: default; background: none;">...</div>';
                }
                pageNumbersHTML += '<div class="page-number" onclick="goToPage(' + totalPages + ')">' + totalPages + '</div>';
            }
            
            pageNumbersElement.innerHTML = pageNumbersHTML;
        }

        // ====================================================
        // ðŸš€ UTILITY FUNCTIONS
        // ====================================================
        function formatPrice(price) {
            const num = parseFloat(price);
            return isNaN(num) ? '0.00' : num.toLocaleString('tr-TR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
    </script>
</body>
</html>